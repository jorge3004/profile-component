{"version":3,"file":"index.js","sources":["../src/properties.ts","../src/pure-lit.ts","../node_modules/lit-element-state-decoupler/dist/clone.js","../node_modules/lit-element-state-decoupler/dist/decorator.js","../node_modules/lit-element-state-decoupler/dist/state.js","../node_modules/lit-element-state-decoupler/dist/reducer.js","../node_modules/lit-element-state-decoupler/dist/workflow.js","../node_modules/lit-element-state-decoupler/dist/index.js","../node_modules/lit-element-effect/dist/decorator.js","../node_modules/lit-element-effect/dist/effect.js","../node_modules/lit-element-effect/dist/index.js","../src/dispatch.ts"],"sourcesContent":["import {\n  PurePropertyDeclaration,\n  DefaultObjectDefinition,\n  PureArguments,\n  DefaultDefinedPureArguments,\n  PropDefinedPureArguments,\n} from \"./types\";\nimport { PropertyDeclaration, PropertyDeclarations } from \"lit\";\n\nfunction toSafeDeclaration(declaration: PurePropertyDeclaration, [key, value]: [string, any]) {\n  if (key.toLowerCase() !== key) {\n    declaration[key] = {...value, attribute: key.replace(/[A-Z]/g, '-$&').toLowerCase()};\n  } else {\n    declaration[key] = value;\n  }\n\n  return declaration;\n}\n\nexport function getType(value: unknown) : PropertyDeclaration {\n  if (typeof value === \"boolean\") return {type: Boolean}\n  if (Array.isArray(value)) return {type: Array}\n  if (typeof value === \"object\") return {type: Object}\n  return {}\n}\n\nexport const toTypeDeclaration = (object: {[key: string]: unknown}) =>\n  Object.entries(object).reduce((result, [key, value]) => {\n      return toSafeDeclaration(result, [key, getType(value)])\n  }, {} as PurePropertyDeclaration) as PurePropertyDeclaration\n\nexport const toPropertyDeclaration = (defaults?: DefaultObjectDefinition) =>\n  toTypeDeclaration(defaults || {});\n\nexport const toPropertyDeclarationMap = (props?: (PurePropertyDeclaration | string)[]) =>\n  (props || []).reduce((declaration: PurePropertyDeclaration, prop) => {\n    Object.entries(prop).forEach((entry) => declaration = toSafeDeclaration(declaration, entry));\n    return declaration;\n  }, {} as PropertyDeclarations);\n\nexport const isDefault = <T>(args?: PureArguments<T>): args is DefaultDefinedPureArguments<T> =>\n  args !== undefined && <T>(args as DefaultDefinedPureArguments<T>).defaults !== undefined;\nexport const hasProps = <T>(args?: PureArguments<T>): args is PropDefinedPureArguments<T> =>\n  args !== undefined && (args as PropDefinedPureArguments<T>).props !== undefined;\n\nexport const toProperties = <T>(args?: PureArguments<T>) =>\n  hasProps(args) ? toPropertyDeclarationMap(args.props) : toPropertyDeclaration(args?.defaults);\n","import { html, LitElement, TemplateResult } from \"lit\";\nimport {\n  RegisteredElements,\n  RenderFunction,\n  LitElementWithProps,\n  PureArguments,\n  AsyncRenderFunction,\n} from \"./types\";\nimport { toProperties, isDefault } from \"./properties\";\n\nexport const registered: RegisteredElements = {};\n\nexport const pureLit = <TProps>(\n  name: string,\n  render: AsyncRenderFunction<TProps> | RenderFunction<TProps>,\n  args?: PureArguments<TProps>\n): LitElementWithProps<TProps> => {\n  if (registered[name]) return registered[name];\n\n  class RuntimeRepresentation extends LitElement {\n    content: TemplateResult = html``;\n    static get properties() {\n      return toProperties(args);\n    }\n    static get styles() {\n      /* istanbul ignore next */\n      return args?.styles;\n    }\n    constructor() {\n      super();\n      if (isDefault(args)) {\n        Object.entries(args!.defaults!).forEach(([key, value]) => {\n          (this as any)[key] = value\n        })\n      }\n    }\n    protected async performUpdate(): Promise<unknown> {\n      this.content = await Promise.resolve(render((this as any) as LitElementWithProps<TProps>))\n        .catch(e => html`<slot name=\"error\">${e}</slot>`);\n      return super.performUpdate();\n    }\n    render(): TemplateResult {\n      return this.content;\n    }\n  }\n\n  customElements.define(name, RuntimeRepresentation);\n\n  const element = document.createElement(name);\n  registered[name] = element;\n  return element as LitElementWithProps<TProps>;\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.shallowClone = void 0;\nfunction shallowClone(value) {\n    if (typeof value !== \"object\" || !value || value instanceof Date || value instanceof RegExp)\n        return value;\n    return (Array.isArray(value)) ? [...value] : Object.assign({}, value);\n}\nexports.shallowClone = shallowClone;\n//# sourceMappingURL=clone.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withWorkflow = exports.withReducer = exports.withState = exports.decorate = exports.asUpdateableLitElement = void 0;\nfunction asUpdateableLitElement(element) {\n    if (!element.dispatchEvent || !element.requestUpdate)\n        throw new Error(\"Element missing required functions (dispatchEvent/requestUpdate)\");\n    return element;\n}\nexports.asUpdateableLitElement = asUpdateableLitElement;\nconst reservedField = \"__registered_states\";\nfunction decorate(litElement) {\n    const decoratedLitElement = litElement;\n    if (decoratedLitElement[reservedField])\n        return decoratedLitElement;\n    const updateableLitLikeElement = asUpdateableLitElement(litElement);\n    const oldUpdated = updateableLitLikeElement.updated;\n    decoratedLitElement[reservedField] = {\n        index: 0,\n        count: 0,\n        states: [],\n        reducers: [],\n        workflows: []\n    };\n    updateableLitLikeElement.updated = (args) => {\n        decoratedLitElement[reservedField].index = 0;\n        return oldUpdated(args);\n    };\n    return decoratedLitElement;\n}\nexports.decorate = decorate;\nfunction withState(litElement, state, options = {}) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count } = decoratedLitElement[reservedField];\n    if (index === count) {\n        decoratedLitElement[reservedField].index++;\n        decoratedLitElement[reservedField].count++;\n        decoratedLitElement[reservedField].states.push(state);\n        return state;\n    }\n    decoratedLitElement[reservedField].index++;\n    if (options.updateDefault)\n        decoratedLitElement[reservedField].states[index].inject(state.get());\n    return decoratedLitElement[reservedField].states[index];\n}\nexports.withState = withState;\nfunction withReducer(litElement, reduce) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count, reducers } = decoratedLitElement[reservedField];\n    if (index === count && !reducers[index - 1]) {\n        decoratedLitElement[reservedField].reducers[index - 1] = reduce;\n        return reduce;\n    }\n    return decoratedLitElement[reservedField].reducers[index - 1];\n}\nexports.withReducer = withReducer;\nfunction withWorkflow(litElement, workflow) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count, workflows } = decoratedLitElement[reservedField];\n    if (index === count && !workflows[index - 1]) {\n        decoratedLitElement[reservedField].workflows[index - 1] = workflow;\n        return workflow;\n    }\n    return decoratedLitElement[reservedField].workflows[index - 1];\n}\nexports.withWorkflow = withWorkflow;\n//# sourceMappingURL=decorator.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useState = void 0;\nconst clone_1 = require(\"./clone\");\nconst decorator_1 = require(\"./decorator\");\nconst useState = (element, defaultValue, options = {}) => {\n    let state = (0, clone_1.shallowClone)(defaultValue);\n    const subscribers = [() => __awaiter(void 0, void 0, void 0, function* () { return (element.requestUpdate(), yield element.updateComplete); })];\n    const set = (update) => __awaiter(void 0, void 0, void 0, function* () {\n        if (state === update)\n            return;\n        state = (0, clone_1.shallowClone)(update);\n        for (const subscriber of subscribers) {\n            yield subscriber(state);\n        }\n    });\n    return (0, decorator_1.withState)(element, new class {\n        set value(update) {\n            set(update);\n        }\n        get value() { return state; }\n        publish(update) { set(update); }\n        set(update) {\n            return __awaiter(this, void 0, void 0, function* () { yield set(update); });\n        }\n        subscribe(onChange) { subscribers.push(onChange); }\n        inject(update) { state = update; }\n        get() { return state; }\n        getState() { return state; }\n    }, options);\n};\nexports.useState = useState;\n//# sourceMappingURL=state.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useReducer = void 0;\nconst state_1 = require(\"./state\");\nconst decorator_1 = require(\"./decorator\");\nconst useReducer = (element, reducer, defaultValue, options = {}) => {\n    const { get: getState, set } = (0, state_1.useState)(element, defaultValue, options);\n    const subscribers = [];\n    const dispatch = (action, payload) => __awaiter(void 0, void 0, void 0, function* () {\n        const reducers = reducer(getState());\n        if (reducers[action]) {\n            yield set(yield reducers[action](payload));\n            subscribers.forEach(subscriber => subscriber(action, getState()));\n            options.dispatchEvent &&\n                element.dispatchEvent(new CustomEvent(action, { detail: getState() }));\n        }\n        return getState();\n    });\n    return (0, decorator_1.withReducer)(element, {\n        get: getState,\n        subscribe: (onChange) => subscribers.push(onChange),\n        when: (action, onChange) => subscribers.push((triggeredAction, state) => triggeredAction === action && onChange(state)),\n        set: dispatch,\n        dispatch\n    });\n};\nexports.useReducer = useReducer;\n//# sourceMappingURL=reducer.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWorkflow = void 0;\nconst _1 = require(\".\");\nconst decorator_1 = require(\"./decorator\");\nconst useWorkflow = (element, reducers) => {\n    const innerReducers = Object.entries(reducers).reduce((prev, [projection, { reducer, initialState }]) => (prev[projection] = (0, _1.useReducer)(element, reducer, initialState), prev), {});\n    const sideeffect = {};\n    const compensations = {};\n    const workflowHistory = [];\n    const projections = (key) => {\n        workflowHistory.push({\n            type: \"projections\",\n            args: [key]\n        });\n        return (innerReducers[key]) ? innerReducers[key].get() : undefined;\n    };\n    const addActivity = (activity, data) => __awaiter(void 0, void 0, void 0, function* () {\n        var _a, _b;\n        workflowHistory.push({\n            type: \"addActivity\",\n            args: [activity, data]\n        });\n        yield Promise.all((_b = (_a = sideeffect[activity]) === null || _a === void 0 ? void 0 : _a.map(effect => effect(data))) !== null && _b !== void 0 ? _b : []);\n        for (const reducer of Object.values(innerReducers)) {\n            yield reducer.dispatch(activity, data);\n        }\n    });\n    const addCompensation = (activity, data) => {\n        workflowHistory.push({\n            type: \"addCompensation\",\n            args: [activity, data]\n        });\n        compensations[activity] = [\n            ...(compensations[activity] || []),\n            data\n        ];\n    };\n    const addSideeffect = (activity, effect) => {\n        workflowHistory.push({\n            type: \"addSideeffect\",\n            args: [activity, effect]\n        });\n        sideeffect[activity] = [\n            ...(sideeffect[activity] || []),\n            effect\n        ];\n    };\n    const compensate = () => __awaiter(void 0, void 0, void 0, function* () {\n        workflowHistory.push({\n            type: \"compensate\",\n            args: []\n        });\n        for (const [activity, dataArguments] of Object.entries(compensations)) {\n            for (const data of dataArguments) {\n                for (const reducer of Object.values(innerReducers)) {\n                    yield reducer.dispatch(activity, data);\n                }\n            }\n        }\n    });\n    const after = (timeout, unlessActivity, execute) => {\n        workflowHistory.push({\n            type: \"after\",\n            args: [timeout, unlessActivity, execute]\n        });\n        const compareWorkflow = (entry, unless) => {\n            if (entry.type !== unless.type)\n                return false;\n            for (let arg = 0; arg < unless.args.length; arg++) {\n                if (entry.args[arg] !== unless.args[arg])\n                    return false;\n            }\n            return true;\n        };\n        const check = () => __awaiter(void 0, void 0, void 0, function* () {\n            if (workflowHistory.some(entry => compareWorkflow(entry, unlessActivity))) {\n                return;\n            }\n            else if (new Date(Date.now()) > timeout) {\n                yield execute();\n            }\n            else {\n                setTimeout(check, 100);\n            }\n        });\n        check();\n    };\n    const plan = (plan) => __awaiter(void 0, void 0, void 0, function* () {\n        for (const [entity, workflow] of Object.entries(plan)) {\n            if (reducers[entity] &&\n                JSON.stringify(projections(entity)) === JSON.stringify(reducers[entity].initialState)) {\n                return yield workflow();\n            }\n        }\n        return plan[\"\"]\n            ? yield plan[\"\"]()\n            : Promise.resolve(null);\n    });\n    return (0, decorator_1.withWorkflow)(element, {\n        addActivity,\n        addSideeffect,\n        projections,\n        addCompensation,\n        compensate,\n        after,\n        plan,\n        history: () => [...workflowHistory]\n    });\n};\nexports.useWorkflow = useWorkflow;\n//# sourceMappingURL=workflow.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWorkflow = exports.useReducer = exports.useState = void 0;\nvar state_1 = require(\"./state\");\nObject.defineProperty(exports, \"useState\", { enumerable: true, get: function () { return state_1.useState; } });\nvar reducer_1 = require(\"./reducer\");\nObject.defineProperty(exports, \"useReducer\", { enumerable: true, get: function () { return reducer_1.useReducer; } });\nvar workflow_1 = require(\"./workflow\");\nObject.defineProperty(exports, \"useWorkflow\", { enumerable: true, get: function () { return workflow_1.useWorkflow; } });\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withEffect = exports.decorate = exports.asUpdateableLitElement = void 0;\nfunction asUpdateableLitElement(element) {\n    if (!element.dispatchEvent || !element.requestUpdate)\n        throw new Error(\"Element missing required functions (dispatchEvent/requestUpdate)\");\n    return element;\n}\nexports.asUpdateableLitElement = asUpdateableLitElement;\nconst reservedKeyword = \"__registered_effects\";\nfunction decorate(litElement) {\n    const decoratedLitElement = litElement;\n    if (decoratedLitElement[reservedKeyword])\n        return decoratedLitElement;\n    const updateableLitLikeElement = asUpdateableLitElement(litElement);\n    const oldUpdated = updateableLitLikeElement.updated;\n    decoratedLitElement[reservedKeyword] = {\n        index: 0,\n        count: 0,\n        effects: [],\n    };\n    updateableLitLikeElement.updated = (args) => {\n        decoratedLitElement[reservedKeyword].index = 0;\n        return oldUpdated(args);\n    };\n    return decoratedLitElement;\n}\nexports.decorate = decorate;\nfunction withEffect(litElement, effect) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count } = decoratedLitElement[reservedKeyword];\n    if (index === count) {\n        decoratedLitElement[reservedKeyword].index++;\n        decoratedLitElement[reservedKeyword].count++;\n        decoratedLitElement[reservedKeyword].effects.push(effect);\n        return effect;\n    }\n    decoratedLitElement[reservedKeyword].index++;\n    return decoratedLitElement[reservedKeyword].effects[index];\n}\nexports.withEffect = withEffect;\n//# sourceMappingURL=decorator.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useOnce = exports.useEffect = void 0;\nconst decorator_1 = require(\"./decorator\");\nfunction useEffect(element, on, observe) {\n    const effect = (0, decorator_1.withEffect)(element, {\n        on,\n        observe: [\"__initial__dirty\"],\n    });\n    effect.observe.some((o, index) => observe[index] !== o) && effect.on();\n    effect.observe = observe;\n}\nexports.useEffect = useEffect;\nconst useOnce = (element, on) => useEffect(element, on, []);\nexports.useOnce = useOnce;\n//# sourceMappingURL=effect.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useOnce = exports.useEffect = void 0;\nvar effect_1 = require(\"./effect\");\nObject.defineProperty(exports, \"useEffect\", { enumerable: true, get: function () { return effect_1.useEffect; } });\nObject.defineProperty(exports, \"useOnce\", { enumerable: true, get: function () { return effect_1.useOnce; } });\n//# sourceMappingURL=index.js.map","import { LitElementWithProps } from \".\";\n\nexport const dispatch = <T>(element: LitElementWithProps<any>, type: string, data?: T, options?: CustomEventInit<T>) => \n    element.dispatchEvent(new CustomEvent(type.trim(), {...options, detail : data}))"],"names":["toSafeDeclaration","declaration","key","value","toLowerCase","attribute","replace","getType","type","Boolean","Array","isArray","Object","toPropertyDeclaration","defaults","toTypeDeclaration","object","entries","reduce","result","toProperties","args","undefined","props","hasProps","prop","forEach","entry","registered","defineProperty","clone","Date","RegExp","assign","asUpdateableLitElement","element","dispatchEvent","requestUpdate","Error","decorator","reservedField","decorate","litElement","decoratedLitElement","updateableLitLikeElement","oldUpdated","updated","index","count","states","reducers","workflows","state","options","push","updateDefault","inject","get","workflow","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","apply","clone_1","require$$0","decorator_1","require$$1","defaultValue","shallowClone","subscribers","updateComplete","set","update","subscriber","withState","[object Object]","onChange","reducer","state_1","getState","useState","dispatch","action","payload","CustomEvent","detail","withReducer","subscribe","when","triggeredAction","workflow_1","_1","innerReducers","prev","projection","initialState","useReducer","sideeffect","compensations","workflowHistory","projections","withWorkflow","addActivity","activity","data","_a","_b","all","map","effect","values","addSideeffect","addCompensation","compensate","dataArguments","after","timeout","unlessActivity","execute","check","some","unless","arg","length","compareWorkflow","now","setTimeout","plan","entity","JSON","stringify","history","exports","enumerable","reducer_1","require$$2","useWorkflow","reservedKeyword","effects","useEffect","on","observe","withEffect","o","effect_1","useOnce","trim","name","render","RuntimeRepresentation","LitElement","super","html","isDefault","properties","styles","content","catch","performUpdate","customElements","define","document","createElement"],"mappings":"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"}