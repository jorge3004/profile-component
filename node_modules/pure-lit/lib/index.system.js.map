{"version":3,"file":"index.system.js","sources":["../src/properties.ts","../src/pure-lit.ts","../node_modules/lit-element-state-decoupler/dist/clone.js","../node_modules/lit-element-state-decoupler/dist/decorator.js","../node_modules/lit-element-state-decoupler/dist/state.js","../node_modules/lit-element-state-decoupler/dist/reducer.js","../node_modules/lit-element-state-decoupler/dist/workflow.js","../node_modules/lit-element-state-decoupler/dist/index.js","../node_modules/lit-element-effect/dist/decorator.js","../node_modules/lit-element-effect/dist/effect.js","../node_modules/lit-element-effect/dist/index.js","../src/dispatch.ts"],"sourcesContent":["import {\n  PurePropertyDeclaration,\n  DefaultObjectDefinition,\n  PureArguments,\n  DefaultDefinedPureArguments,\n  PropDefinedPureArguments,\n} from \"./types\";\nimport { PropertyDeclaration, PropertyDeclarations } from \"lit\";\n\nfunction toSafeDeclaration(declaration: PurePropertyDeclaration, [key, value]: [string, any]) {\n  if (key.toLowerCase() !== key) {\n    declaration[key] = {...value, attribute: key.replace(/[A-Z]/g, '-$&').toLowerCase()};\n  } else {\n    declaration[key] = value;\n  }\n\n  return declaration;\n}\n\nexport function getType(value: unknown) : PropertyDeclaration {\n  if (typeof value === \"boolean\") return {type: Boolean}\n  if (Array.isArray(value)) return {type: Array}\n  if (typeof value === \"object\") return {type: Object}\n  return {}\n}\n\nexport const toTypeDeclaration = (object: {[key: string]: unknown}) =>\n  Object.entries(object).reduce((result, [key, value]) => {\n      return toSafeDeclaration(result, [key, getType(value)])\n  }, {} as PurePropertyDeclaration) as PurePropertyDeclaration\n\nexport const toPropertyDeclaration = (defaults?: DefaultObjectDefinition) =>\n  toTypeDeclaration(defaults || {});\n\nexport const toPropertyDeclarationMap = (props?: (PurePropertyDeclaration | string)[]) =>\n  (props || []).reduce((declaration: PurePropertyDeclaration, prop) => {\n    Object.entries(prop).forEach((entry) => declaration = toSafeDeclaration(declaration, entry));\n    return declaration;\n  }, {} as PropertyDeclarations);\n\nexport const isDefault = <T>(args?: PureArguments<T>): args is DefaultDefinedPureArguments<T> =>\n  args !== undefined && <T>(args as DefaultDefinedPureArguments<T>).defaults !== undefined;\nexport const hasProps = <T>(args?: PureArguments<T>): args is PropDefinedPureArguments<T> =>\n  args !== undefined && (args as PropDefinedPureArguments<T>).props !== undefined;\n\nexport const toProperties = <T>(args?: PureArguments<T>) =>\n  hasProps(args) ? toPropertyDeclarationMap(args.props) : toPropertyDeclaration(args?.defaults);\n","import { html, LitElement, TemplateResult } from \"lit\";\nimport {\n  RegisteredElements,\n  RenderFunction,\n  LitElementWithProps,\n  PureArguments,\n  AsyncRenderFunction,\n} from \"./types\";\nimport { toProperties, isDefault } from \"./properties\";\n\nexport const registered: RegisteredElements = {};\n\nexport const pureLit = <TProps>(\n  name: string,\n  render: AsyncRenderFunction<TProps> | RenderFunction<TProps>,\n  args?: PureArguments<TProps>\n): LitElementWithProps<TProps> => {\n  if (registered[name]) return registered[name];\n\n  class RuntimeRepresentation extends LitElement {\n    content: TemplateResult = html``;\n    static get properties() {\n      return toProperties(args);\n    }\n    static get styles() {\n      /* istanbul ignore next */\n      return args?.styles;\n    }\n    constructor() {\n      super();\n      if (isDefault(args)) {\n        Object.entries(args!.defaults!).forEach(([key, value]) => {\n          (this as any)[key] = value\n        })\n      }\n    }\n    protected async performUpdate(): Promise<unknown> {\n      this.content = await Promise.resolve(render((this as any) as LitElementWithProps<TProps>))\n        .catch(e => html`<slot name=\"error\">${e}</slot>`);\n      return super.performUpdate();\n    }\n    render(): TemplateResult {\n      return this.content;\n    }\n  }\n\n  customElements.define(name, RuntimeRepresentation);\n\n  const element = document.createElement(name);\n  registered[name] = element;\n  return element as LitElementWithProps<TProps>;\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.shallowClone = void 0;\nfunction shallowClone(value) {\n    if (typeof value !== \"object\" || !value || value instanceof Date || value instanceof RegExp)\n        return value;\n    return (Array.isArray(value)) ? [...value] : Object.assign({}, value);\n}\nexports.shallowClone = shallowClone;\n//# sourceMappingURL=clone.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withWorkflow = exports.withReducer = exports.withState = exports.decorate = exports.asUpdateableLitElement = void 0;\nfunction asUpdateableLitElement(element) {\n    if (!element.dispatchEvent || !element.requestUpdate)\n        throw new Error(\"Element missing required functions (dispatchEvent/requestUpdate)\");\n    return element;\n}\nexports.asUpdateableLitElement = asUpdateableLitElement;\nconst reservedField = \"__registered_states\";\nfunction decorate(litElement) {\n    const decoratedLitElement = litElement;\n    if (decoratedLitElement[reservedField])\n        return decoratedLitElement;\n    const updateableLitLikeElement = asUpdateableLitElement(litElement);\n    const oldUpdated = updateableLitLikeElement.updated;\n    decoratedLitElement[reservedField] = {\n        index: 0,\n        count: 0,\n        states: [],\n        reducers: [],\n        workflows: []\n    };\n    updateableLitLikeElement.updated = (args) => {\n        decoratedLitElement[reservedField].index = 0;\n        return oldUpdated(args);\n    };\n    return decoratedLitElement;\n}\nexports.decorate = decorate;\nfunction withState(litElement, state, options = {}) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count } = decoratedLitElement[reservedField];\n    if (index === count) {\n        decoratedLitElement[reservedField].index++;\n        decoratedLitElement[reservedField].count++;\n        decoratedLitElement[reservedField].states.push(state);\n        return state;\n    }\n    decoratedLitElement[reservedField].index++;\n    if (options.updateDefault)\n        decoratedLitElement[reservedField].states[index].inject(state.get());\n    return decoratedLitElement[reservedField].states[index];\n}\nexports.withState = withState;\nfunction withReducer(litElement, reduce) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count, reducers } = decoratedLitElement[reservedField];\n    if (index === count && !reducers[index - 1]) {\n        decoratedLitElement[reservedField].reducers[index - 1] = reduce;\n        return reduce;\n    }\n    return decoratedLitElement[reservedField].reducers[index - 1];\n}\nexports.withReducer = withReducer;\nfunction withWorkflow(litElement, workflow) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count, workflows } = decoratedLitElement[reservedField];\n    if (index === count && !workflows[index - 1]) {\n        decoratedLitElement[reservedField].workflows[index - 1] = workflow;\n        return workflow;\n    }\n    return decoratedLitElement[reservedField].workflows[index - 1];\n}\nexports.withWorkflow = withWorkflow;\n//# sourceMappingURL=decorator.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useState = void 0;\nconst clone_1 = require(\"./clone\");\nconst decorator_1 = require(\"./decorator\");\nconst useState = (element, defaultValue, options = {}) => {\n    let state = (0, clone_1.shallowClone)(defaultValue);\n    const subscribers = [() => __awaiter(void 0, void 0, void 0, function* () { return (element.requestUpdate(), yield element.updateComplete); })];\n    const set = (update) => __awaiter(void 0, void 0, void 0, function* () {\n        if (state === update)\n            return;\n        state = (0, clone_1.shallowClone)(update);\n        for (const subscriber of subscribers) {\n            yield subscriber(state);\n        }\n    });\n    return (0, decorator_1.withState)(element, new class {\n        set value(update) {\n            set(update);\n        }\n        get value() { return state; }\n        publish(update) { set(update); }\n        set(update) {\n            return __awaiter(this, void 0, void 0, function* () { yield set(update); });\n        }\n        subscribe(onChange) { subscribers.push(onChange); }\n        inject(update) { state = update; }\n        get() { return state; }\n        getState() { return state; }\n    }, options);\n};\nexports.useState = useState;\n//# sourceMappingURL=state.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useReducer = void 0;\nconst state_1 = require(\"./state\");\nconst decorator_1 = require(\"./decorator\");\nconst useReducer = (element, reducer, defaultValue, options = {}) => {\n    const { get: getState, set } = (0, state_1.useState)(element, defaultValue, options);\n    const subscribers = [];\n    const dispatch = (action, payload) => __awaiter(void 0, void 0, void 0, function* () {\n        const reducers = reducer(getState());\n        if (reducers[action]) {\n            yield set(yield reducers[action](payload));\n            subscribers.forEach(subscriber => subscriber(action, getState()));\n            options.dispatchEvent &&\n                element.dispatchEvent(new CustomEvent(action, { detail: getState() }));\n        }\n        return getState();\n    });\n    return (0, decorator_1.withReducer)(element, {\n        get: getState,\n        subscribe: (onChange) => subscribers.push(onChange),\n        when: (action, onChange) => subscribers.push((triggeredAction, state) => triggeredAction === action && onChange(state)),\n        set: dispatch,\n        dispatch\n    });\n};\nexports.useReducer = useReducer;\n//# sourceMappingURL=reducer.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWorkflow = void 0;\nconst _1 = require(\".\");\nconst decorator_1 = require(\"./decorator\");\nconst useWorkflow = (element, reducers) => {\n    const innerReducers = Object.entries(reducers).reduce((prev, [projection, { reducer, initialState }]) => (prev[projection] = (0, _1.useReducer)(element, reducer, initialState), prev), {});\n    const sideeffect = {};\n    const compensations = {};\n    const workflowHistory = [];\n    const projections = (key) => {\n        workflowHistory.push({\n            type: \"projections\",\n            args: [key]\n        });\n        return (innerReducers[key]) ? innerReducers[key].get() : undefined;\n    };\n    const addActivity = (activity, data) => __awaiter(void 0, void 0, void 0, function* () {\n        var _a, _b;\n        workflowHistory.push({\n            type: \"addActivity\",\n            args: [activity, data]\n        });\n        yield Promise.all((_b = (_a = sideeffect[activity]) === null || _a === void 0 ? void 0 : _a.map(effect => effect(data))) !== null && _b !== void 0 ? _b : []);\n        for (const reducer of Object.values(innerReducers)) {\n            yield reducer.dispatch(activity, data);\n        }\n    });\n    const addCompensation = (activity, data) => {\n        workflowHistory.push({\n            type: \"addCompensation\",\n            args: [activity, data]\n        });\n        compensations[activity] = [\n            ...(compensations[activity] || []),\n            data\n        ];\n    };\n    const addSideeffect = (activity, effect) => {\n        workflowHistory.push({\n            type: \"addSideeffect\",\n            args: [activity, effect]\n        });\n        sideeffect[activity] = [\n            ...(sideeffect[activity] || []),\n            effect\n        ];\n    };\n    const compensate = () => __awaiter(void 0, void 0, void 0, function* () {\n        workflowHistory.push({\n            type: \"compensate\",\n            args: []\n        });\n        for (const [activity, dataArguments] of Object.entries(compensations)) {\n            for (const data of dataArguments) {\n                for (const reducer of Object.values(innerReducers)) {\n                    yield reducer.dispatch(activity, data);\n                }\n            }\n        }\n    });\n    const after = (timeout, unlessActivity, execute) => {\n        workflowHistory.push({\n            type: \"after\",\n            args: [timeout, unlessActivity, execute]\n        });\n        const compareWorkflow = (entry, unless) => {\n            if (entry.type !== unless.type)\n                return false;\n            for (let arg = 0; arg < unless.args.length; arg++) {\n                if (entry.args[arg] !== unless.args[arg])\n                    return false;\n            }\n            return true;\n        };\n        const check = () => __awaiter(void 0, void 0, void 0, function* () {\n            if (workflowHistory.some(entry => compareWorkflow(entry, unlessActivity))) {\n                return;\n            }\n            else if (new Date(Date.now()) > timeout) {\n                yield execute();\n            }\n            else {\n                setTimeout(check, 100);\n            }\n        });\n        check();\n    };\n    const plan = (plan) => __awaiter(void 0, void 0, void 0, function* () {\n        for (const [entity, workflow] of Object.entries(plan)) {\n            if (reducers[entity] &&\n                JSON.stringify(projections(entity)) === JSON.stringify(reducers[entity].initialState)) {\n                return yield workflow();\n            }\n        }\n        return plan[\"\"]\n            ? yield plan[\"\"]()\n            : Promise.resolve(null);\n    });\n    return (0, decorator_1.withWorkflow)(element, {\n        addActivity,\n        addSideeffect,\n        projections,\n        addCompensation,\n        compensate,\n        after,\n        plan,\n        history: () => [...workflowHistory]\n    });\n};\nexports.useWorkflow = useWorkflow;\n//# sourceMappingURL=workflow.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWorkflow = exports.useReducer = exports.useState = void 0;\nvar state_1 = require(\"./state\");\nObject.defineProperty(exports, \"useState\", { enumerable: true, get: function () { return state_1.useState; } });\nvar reducer_1 = require(\"./reducer\");\nObject.defineProperty(exports, \"useReducer\", { enumerable: true, get: function () { return reducer_1.useReducer; } });\nvar workflow_1 = require(\"./workflow\");\nObject.defineProperty(exports, \"useWorkflow\", { enumerable: true, get: function () { return workflow_1.useWorkflow; } });\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withEffect = exports.decorate = exports.asUpdateableLitElement = void 0;\nfunction asUpdateableLitElement(element) {\n    if (!element.dispatchEvent || !element.requestUpdate)\n        throw new Error(\"Element missing required functions (dispatchEvent/requestUpdate)\");\n    return element;\n}\nexports.asUpdateableLitElement = asUpdateableLitElement;\nconst reservedKeyword = \"__registered_effects\";\nfunction decorate(litElement) {\n    const decoratedLitElement = litElement;\n    if (decoratedLitElement[reservedKeyword])\n        return decoratedLitElement;\n    const updateableLitLikeElement = asUpdateableLitElement(litElement);\n    const oldUpdated = updateableLitLikeElement.updated;\n    decoratedLitElement[reservedKeyword] = {\n        index: 0,\n        count: 0,\n        effects: [],\n    };\n    updateableLitLikeElement.updated = (args) => {\n        decoratedLitElement[reservedKeyword].index = 0;\n        return oldUpdated(args);\n    };\n    return decoratedLitElement;\n}\nexports.decorate = decorate;\nfunction withEffect(litElement, effect) {\n    const decoratedLitElement = decorate(litElement);\n    const { index, count } = decoratedLitElement[reservedKeyword];\n    if (index === count) {\n        decoratedLitElement[reservedKeyword].index++;\n        decoratedLitElement[reservedKeyword].count++;\n        decoratedLitElement[reservedKeyword].effects.push(effect);\n        return effect;\n    }\n    decoratedLitElement[reservedKeyword].index++;\n    return decoratedLitElement[reservedKeyword].effects[index];\n}\nexports.withEffect = withEffect;\n//# sourceMappingURL=decorator.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useOnce = exports.useEffect = void 0;\nconst decorator_1 = require(\"./decorator\");\nfunction useEffect(element, on, observe) {\n    const effect = (0, decorator_1.withEffect)(element, {\n        on,\n        observe: [\"__initial__dirty\"],\n    });\n    effect.observe.some((o, index) => observe[index] !== o) && effect.on();\n    effect.observe = observe;\n}\nexports.useEffect = useEffect;\nconst useOnce = (element, on) => useEffect(element, on, []);\nexports.useOnce = useOnce;\n//# sourceMappingURL=effect.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useOnce = exports.useEffect = void 0;\nvar effect_1 = require(\"./effect\");\nObject.defineProperty(exports, \"useEffect\", { enumerable: true, get: function () { return effect_1.useEffect; } });\nObject.defineProperty(exports, \"useOnce\", { enumerable: true, get: function () { return effect_1.useOnce; } });\n//# sourceMappingURL=index.js.map","import { LitElementWithProps } from \".\";\n\nexport const dispatch = <T>(element: LitElementWithProps<any>, type: string, data?: T, options?: CustomEventInit<T>) => \n    element.dispatchEvent(new CustomEvent(type.trim(), {...options, detail : data}))"],"names":["toSafeDeclaration","declaration","key","value","toLowerCase","attribute","replace","getType","type","Boolean","Array","isArray","Object","toPropertyDeclaration","defaults","toTypeDeclaration","object","entries","reduce","result","toProperties","args","undefined","props","hasProps","prop","forEach","entry","registered","name","render","customElements","define","LitElement","[object Object]","super","this","html","isDefault","properties","styles","content","Promise","resolve","catch","e","performUpdate","element","document","createElement","defineProperty","clone","Date","RegExp","assign","asUpdateableLitElement","dispatchEvent","requestUpdate","Error","decorator","reservedField","decorate","litElement","decoratedLitElement","updateableLitLikeElement","oldUpdated","updated","index","count","states","reducers","workflows","state","options","push","updateDefault","inject","get","workflow","__awaiter","thisArg","_arguments","P","generator","reject","fulfilled","step","next","rejected","done","then","apply","clone_1","require$$0","decorator_1","require$$1","defaultValue","shallowClone","subscribers","updateComplete","set","update","subscriber","withState","onChange","reducer","state_1","getState","useState","dispatch","action","payload","CustomEvent","detail","withReducer","subscribe","when","triggeredAction","workflow_1","_1","innerReducers","prev","projection","initialState","useReducer","sideeffect","compensations","workflowHistory","projections","withWorkflow","addActivity","activity","data","_a","_b","all","map","effect","values","addSideeffect","addCompensation","compensate","dataArguments","after","timeout","unlessActivity","execute","check","some","unless","arg","length","compareWorkflow","now","setTimeout","plan","entity","JSON","stringify","history","exports","enumerable","reducer_1","require$$2","useWorkflow","reservedKeyword","effects","useEffect","on","observe","withEffect","o","effect_1","useOnce","trim"],"mappings":"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"}